---
import type { Locale } from '../../../i18n/locales';
interface Props { locale: Locale; }
const { locale } = Astro.props;
---

<h1>Adding Users & Groups</h1>
<p class="subtitle">Step-by-step: create your company's user structure in Authentik.</p>

<h2><span class="step-number">1</span> Plan Your Groups</h2>
<p>Think about your company's job functions. Each group maps to a set of permissions across all apps. Common examples:</p>
<table>
  <tr><th>Group</th><th>Who's in it</th><th>What they get</th></tr>
  <tr><td><code>engineering</code></td><td>Developers, DevOps</td><td>Full code access, wiki read/write, task boards</td></tr>
  <tr><td><code>management</code></td><td>Team leads, executives</td><td>Wiki admin, timesheet approval, view-only code</td></tr>
  <tr><td><code>hr</code></td><td>HR team</td><td>Wiki admin, timesheet approval, NO code access</td></tr>
  <tr><td><code>design</code></td><td>Designers</td><td>File access, wiki read/write, task boards</td></tr>
</table>

<h2><span class="step-number">2</span> Create Groups in Authentik</h2>
<ol>
  <li>Open Authentik admin: <a href="http://auth.localhost/if/admin/#/identity/groups">auth.localhost/if/admin â†’ Directory â†’ Groups</a></li>
  <li>Click <strong>Create</strong></li>
  <li>Enter the group name (e.g., <code>engineering</code>)</li>
  <li>Click <strong>Create</strong></li>
</ol>
<p>Within seconds, all 4 adapters receive a webhook and create the corresponding resources:</p>
<ul>
  <li>Gitea: organization <code>engineering</code></li>
  <li>Mattermost: channel <code>engineering</code></li>
  <li>Outline: group <code>engineering</code></li>
  <li>Stalwart: mailing list <code>engineering@yourdomain.com</code></li>
</ul>

<h2><span class="step-number">3</span> Create Users</h2>
<ol>
  <li>Go to <strong>Directory â†’ Users</strong> in Authentik admin</li>
  <li>Click <strong>Create</strong></li>
  <li>Fill in: username, display name, email</li>
  <li>Set a temporary password (user can change on first login)</li>
  <li>Click <strong>Create</strong></li>
</ol>

<h2><span class="step-number">4</span> Add Users to Groups</h2>
<ol>
  <li>Open the user you just created</li>
  <li>Go to the <strong>Groups</strong> tab</li>
  <li>Click <strong>Add to existing group</strong></li>
  <li>Select the group(s) this user belongs to</li>
</ol>

<div class="callout callout-tip">
  <strong>ðŸ’¡ What happens next</strong>
  Authentik fires a webhook. If the user has already logged into an app, they're immediately added to the group/channel/org. If they haven't logged in yet, the membership is queued and applied automatically on their first login.
</div>

<h2><span class="step-number">5</span> Tell Users to Log In</h2>
<p>Share the app URLs with your users. On first login to any app via SSO:</p>
<ol>
  <li>A local account is auto-created in the app</li>
  <li>All pending group memberships are applied</li>
  <li>If Stalwart is enabled, a mailbox is auto-provisioned</li>
  <li>If Mattermost onboarding is enabled, they get a welcome DM with communication links</li>
</ol>
